/*
 * Copyright 2016-2024 NXP
 * All rights reserved.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

/**
 * @file    probando_con_lcd.c
 * @brief   Application entry point.
 */
#include <stdio.h>
#include "board.h"
#include "peripherals.h"
#include "pin_mux.h"
#include "clock_config.h"
#include "MK64F12.h"
#include "fsl_debug_console.h"
/* TODO: insert other include files here. */
#include "FreeRTOS.h"
#include "semphr.h"
#include "task.h"
#include "lcd_driver.h"
#include "rtos_spi.h"
/* TODO: insert other definitions and declarations here. */
SemaphoreHandle_t semInit;
void taskInit (void* args);
void taskSend (void* args);



static uint8_t Cangrejo_perron_mono [] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x04, 0x0E, 0x1E, 0x3E, 0xFE, 0xFE, 0xFE, 0xFE,
		0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0x00, 0x00, 0x00, 0xFE, 0xFE, 0xFE,
		0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0x7E, 0x3E, 0x0E, 0x06, 0x82, 0xC0,
		0xE0, 0xF0, 0xF8, 0xFC, 0xF8, 0xF8, 0xF8, 0xF8, 0xF0, 0xF0, 0xF0, 0xE0,
		0xE0, 0xC0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0,
		0xE0, 0xF0, 0xF0, 0xF0, 0xF8, 0xF8, 0xF8, 0x78, 0x3C, 0x3D, 0x3F, 0x9F,
		0x9F, 0x9F, 0xDF, 0xCF, 0xCF, 0xCF, 0xE0, 0xE0, 0xE0, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFD, 0xFC, 0xFC, 0xF8, 0xF8, 0xF1, 0xF3, 0xE3,
		0x07, 0x07, 0x0F, 0x0F, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFC, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0F, 0x1F, 0x1F,
		0x3F, 0x3F, 0x7F, 0x7F, 0x7F, 0xF9, 0xF0, 0xE0, 0xC0, 0xC6, 0xCF, 0x8F,
		0x9F, 0x9F, 0x9F, 0xBF, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F,
		0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xEF, 0xEF, 0xC7, 0x87, 0x03, 0x13, 0x39,
		0x78, 0xF8, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF, 0xBF, 0x3F, 0x3F, 0x1F, 0x1F,
		0x0F, 0x0F, 0x07, 0x07, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xE0, 0xF9, 0xFD,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
		0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE,
		0xFC, 0xF8, 0xF0, 0xF1, 0xE3, 0xC7, 0x87, 0x0F, 0x1F, 0x3F, 0x7F, 0x7E,
		0xFC, 0xFC, 0xF8, 0xF8, 0xF0, 0xF0, 0xE0, 0xE0, 0xC0, 0x80, 0x80, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0,
		0xF0, 0x70, 0x30, 0x38, 0x18, 0x08, 0x0A, 0x0B, 0x03, 0x03, 0x03, 0x03,
		0xFB, 0xFB, 0xFB, 0xFB, 0x03, 0x03, 0x03, 0x03, 0x03, 0xF8, 0xF8, 0xF8,
		0xF0, 0x03, 0x03, 0x03, 0x03, 0x83, 0xC3, 0xE3, 0xF3, 0x73, 0x33, 0x3B,
		0x1B, 0x0B, 0x0B, 0x0B, 0x03, 0x03, 0x03, 0x03, 0xFA, 0xFA, 0xF8, 0xF8,
		0xF8, 0x19, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x1B, 0x03, 0x03, 0x03, 0x03,
		0xFB, 0xFA, 0xFA, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0F, 0x1F, 0x3F,
		0x70, 0x70, 0x60, 0x40, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x7F, 0x7F, 0x7F, 0x7F, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7F, 0x7F, 0x7F,
		0x3F, 0x00, 0x00, 0x00, 0x07, 0x0F, 0x1F, 0x3F, 0x70, 0x70, 0x60, 0x40,
		0x40, 0x00, 0x00, 0x00, 0x10, 0x10, 0x10, 0x10, 0x7F, 0x7F, 0x7F, 0x7F,
		0x7F, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x50, 0x00, 0x00, 0x00, 0x00,
		0x7F, 0x7F, 0x7F, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};


/*
 * @brief   Application entry point.
 */
int main(void) {

    /* Init board hardware. */
    BOARD_InitBootPins();
    BOARD_InitBootClocks();
    BOARD_InitBootPeripherals();
#ifndef BOARD_INIT_DEBUG_CONSOLE_PERIPHERAL
    /* Init FSL debug console. */
    BOARD_InitDebugConsole();
#endif
    NVIC_SetPriority(SPI0_IRQn, 5);
    PRINTF("Hello World\r\n");

    semInit = xSemaphoreCreateBinary();

    xTaskCreate(taskSend, "send data",700,NULL,3 ,NULL);
    xTaskCreate(taskInit, "init",200,NULL,4 ,NULL);

    vTaskStartScheduler();
    while(1) {

        __asm volatile ("nop");
    }
    return 0 ;
}


void taskInit (void* args)
{
	rtosSPI_master_config_t config;

	config.baudRate = 115200;
	config.miso_pin = 3;
	config.mode = TRANSFER_MODE_0;
	config.mosi_pin = 2;
	config.pcs_pin = 0;
	config.port_mux = 2;
	config.sclk_pin = 1;
	config.spi_number = 0;
	config.spi_port = 0;

	rtosSPI_init(&config);

	LCD_begin();
	clearLCD();
	setCursor(2,2);
	while (1)
	{
		xSemaphoreGive(semInit);
		vTaskSuspend(NULL);
	}
}
void taskSend (void* args)
{
	xSemaphoreTake(semInit, portMAX_DELAY);
	while(1)
	{
        portTickType xLastWakeTime;
        xLastWakeTime = xTaskGetTickCount();
		printImage(Cangrejo_perron_mono);
      //  setPixel(1, 1);
		vTaskDelayUntil(&xLastWakeTime, pdMS_TO_TICKS(5000));
	}

}
